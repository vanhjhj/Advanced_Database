-- Tạo filegroup cho các phân vùng
ALTER DATABASE QUAN_LY_NHA_HANG ADD FILEGROUP FG_2010_2015;
ALTER DATABASE QUAN_LY_NHA_HANG ADD FILEGROUP FG_2015_2020;
ALTER DATABASE QUAN_LY_NHA_HANG ADD FILEGROUP FG_2020_2024;
GO

-- Tạo tệp dữ liệu cho từng filegroup
ALTER DATABASE QUAN_LY_NHA_HANG
ADD FILE (
    NAME = 'HD_FG_2010_2015',
    FILENAME = 'D:\HD_FG_2010_2015.ndf',
    SIZE = 10MB
) TO FILEGROUP FG_2010_2015;

ALTER DATABASE QUAN_LY_NHA_HANG
ADD FILE (
    NAME = 'HD_FG_2015_2020',
    FILENAME = 'D:\HD_FG_2015_2020.ndf',
    SIZE = 10MB
) TO FILEGROUP FG_2015_2020;

ALTER DATABASE QUAN_LY_NHA_HANG
ADD FILE (
    NAME = 'HD_FG_2020_2024',
    FILENAME = 'D:\HD_FG_2020_2024.ndf',
    SIZE = 10MB
) TO FILEGROUP FG_2020_2024;

GO
CREATE PARTITION FUNCTION PF_HoaDon_NgayLapHD(DATETIME)
AS RANGE RIGHT FOR VALUES ('2015-01-01','2020-01-01','2024-01-01')

CREATE PARTITION SCHEME PS_HoaDon_NgayLapHD 
AS PARTITION PF_HoaDon_NgayLapHD 
TO ([FG_2010_2015], [FG_2015_2020], [FG_2020_2024], [PRIMARY]);
GO

ALTER TABLE dbo.DanhGia
DROP CONSTRAINT FK_DanhGia_HoaDon;

ALTER TABLE dbo.HoaDon
DROP CONSTRAINT PK__HoaDon__2725A6E0E0D091C9;

ALTER TABLE dbo.HoaDon
ADD PRIMARY KEY 
NONCLUSTERED (MaHD)
ON [PRIMARY]

ALTER TABLE dbo.DanhGia
ADD CONSTRAINT FK_DanhGia_HoaDon
FOREIGN KEY (MaHD) REFERENCES dbo.HoaDon (MaHD);

CREATE CLUSTERED INDEX Idx_HoaDon_NgayLapHD 
ON dbo.HoaDon (NgayLapHD) ON PS_HoaDon_NgayLapHD (NgayLapHD);




